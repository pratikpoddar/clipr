$.fn.preloader=function(a){a=$.extend({delay:1,preload_parent:"a",check_timer:300,ondone:function(){},oneachload:function(){},fadein:50},a);var c=$(this).find("img").css({visibility:"hidden",opacity:0}),d,g=0,b=0,e=[],f=a.delay;c.each(function(){0==$(this).parent(a.preload_parent).length?$(this).wrap("<a class='preloader' />"):$(this).parent().addClass("preloader");e[b++]=!1});var c=$.makeArray(c),h=jQuery("<img />",{id:"loadingicon",src:""}).hide().appendTo("body");d=setInterval(function(){!0==h[0].complete&&
(clearInterval(d),d=setInterval(function(){if(g>=e.length)clearInterval(d),a.ondone();else for(b=0;b<c.length;b++)!0==c[b].complete&&(!1==e[b]&&(e[b]=!0,a.oneachload(c[b]),g++,f+=a.delay),$(c[b]).css("visibility","visible").delay(f).animate({opacity:1},a.fadein,function(){$(this).parent().removeClass("preloader")}))},a.check_timer),h.remove())},100)};