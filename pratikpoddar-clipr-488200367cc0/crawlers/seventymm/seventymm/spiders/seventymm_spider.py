from scrapy.spider import BaseSpider
from scrapy.selector import HtmlXPathSelector
from scrapy.contrib.linkextractors.sgml import SgmlLinkExtractor
from scrapy.contrib.spiders import CrawlSpider, Rule
from seventymm.items import CliprItem

class DmozSpider(CrawlSpider):
    name = "seventymm"
    allowed_domains = ["seventymm.com"]
    start_urls = [
		"http://shop.seventymm.com/",
		"http://shop.seventymm.com/Brands/All-Brands/1/2/2/Show",
		"http://shop.seventymm.com/Browse/AllProducts/2705/1/NoFilters/0/0/1/2/3/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2705/1/V655/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2232/1/V655/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2705/1/V663/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2705/1/V657/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2705/1/V634/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Product/5/Buy-Sports-Essentials-Sports-Accessories-Geonaute-B-Solognac-200-Binoculars/38687/2706/Show",
		"http://shop.seventymm.com/Product/5/Buy-Sports-Essentials-Sports-Accessories-Geonaute-Aneona-Hidden-Neck-Pouch-Bag/38575/2706/Show",
		"http://shop.seventymm.com/Browse/Buy-Mickey-Mouse/61/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Popeye/64/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Power-Ranger/65/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Spiderman/68/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Superman/69/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Tintin/70/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Tom-andamp-Jerry/72/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Winnie-The-Pooh/73/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Simba/74/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Tweety/551/3/Show",
		"http://shop.seventymm.com/Browse/Buy-MAD-Pogo/60/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Little-Krishna/58/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Hannah-Montana/56/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Garfield/55/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Doraemon/53/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Dora/52/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Chhota-Bheem/50/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Ben-10/48/3/Show",
		"http://shop.seventymm.com/Browse/Buy-Barbie/45/3/Show",
		"http://shop.seventymm.com/My-Account/Browse-History",
		"http://shop.seventymm.com/Browse/Buy-Kids-Stuff/2234/1/Show",
		"http://shop.seventymm.com/Browse/Buy-Apparels/2231/1/Show",
		"http://shop.seventymm.com/Browse/Buy-Electronics-and-More/2235/1/Show",
		"http://shop.seventymm.com/Browse/Buy-Apparels/2231/1/Show",
		"http://shop.seventymm.com/Browse/Buy-Footwear/2232/1/Show",
		"http://shop.seventymm.com/Browse/Buy-Jewelry/2233/1/Show",
		"http://shop.seventymm.com/Browse/Buy-Kids-Stuff/2234/1/Show",
		"http://shop.seventymm.com/Browse/Buy-Electronics/2235/1/Show", 
		"http://shop.seventymm.com/Browse/Buy-Fashion-Accessories/2236/1/Show",
		"http://shop.seventymm.com/Browse/Buy-Home-and-Lifestyle/2237/1/Show", 
		"http://shop.seventymm.com/Browse/Buy-Movie-and-Music/2239/1/Show", 
		"http://shop.seventymm.com/Browse/Buy-Books-and-Stationery/2240/1/Show", 
		"http://shop.seventymm.com/Browse/Buy-Sports-Essentials/2705/1/Show", 
		"http://shop.seventymm.com/FlashSale"
		"http://shop.seventymm.com/",
		"http://shop.seventymm.com/Browse/AllProducts/2231/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2231/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2231/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2231/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2231/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2231/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2232/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2232/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2232/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2232/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/Buy-Jewelry-Jewelry-Sets/2262/1/Go",
		"http://shop.seventymm.com/Browse/Buy-Jewelry-Mangalsutras/2712/1/Go",
		"http://shop.seventymm.com/Browse/Buy-Jewelry-Pendants/2261/1/Go",
		"http://shop.seventymm.com/Browse/Buy-Jewelry-Rings/2263/1/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V1045/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V648/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V82/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V358/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V712/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V936/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V83/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V713/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V75/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V1246/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V647/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V79/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V771/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V1210/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V1100/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2251/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2511/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2252/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2708/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2257/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2512/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2512/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2257/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2258/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2708/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2511/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2251/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2251/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2511/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2252/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2251/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2511/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2252/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2232/1/V387/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2232/1/V1076/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2232/1/V715/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2232/1/V762/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2232/1/V962/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2649/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2242/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2245/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2244/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2503/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2241/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2247/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2246/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2734/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2767/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2499/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2504/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2729/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2242/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2505/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2508/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2713/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2244/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2245/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2503/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2241/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2713/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2659/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2241/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2231/1/V944/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2231/1/V1245/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2231/1/V1181/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2231/1/V401/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2231/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2270/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2235/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2236/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2232/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2269/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2237/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2239/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2705/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2231/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2514/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2270/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2240/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2235/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2236/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2232/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2269/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2237/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2233/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2239/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2705/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2234/1/V73/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2234/1/V70/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2234/1/V68/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2234/1/V74/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2234/1/V61/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2234/1/V58/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2234/1/V56/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2234/1/V53/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2234/1/V52/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2234/1/V593/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2234/1/V45/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2234/1/V48/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2234/1/V1015/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/Buy-Electronics-Computers/2278/1/Go",
		"http://shop.seventymm.com/Browse/Buy-Electronics-Digital-Cameras/2279/1/Go",
		"http://shop.seventymm.com/Browse/Buy-Electronics-Games-and-Consoles/2283/1/Go",
		"http://shop.seventymm.com/Browse/Buy-Electronics-Mobiles-and-Phones/2276/1/Go",
		"http://shop.seventymm.com/Browse/Buy-Electronics-Tablets/2277/1/Go",
		"http://shop.seventymm.com/Browse/Buy-Electronics-TV-Video-and-MP3-Players/2280/1/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2236/1/V247/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2236/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2236/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2236/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/Buy-Fashion-Accessories/2236/1/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2236/1/V249/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2236/1/V250/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/Buy-Fashion-Accessories/2236/1/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2236/1/V248/0/0/1/2/4/0/Go",
		"http://shop.seventymm.com/Browse/AllProducts/2236/1/V247/0/0/1/2/4/0/Go"
    ]
    rules = (
        # Extract links matching 'category.php' (but not matching 'subsection.php')
        # and follow links from them (since no callback means follow=True by default).
        Rule(SgmlLinkExtractor(allow=('/Product/', )), callback='parse_item',follow=True),
    )

    def parse_item(self, response):
		site = HtmlXPathSelector(response)
		items = []
		item = CliprItem()
		tester = site.select('//div[@class="clearfix prd-details-ct"]')
		item['title'] = site.select('//div[@class="ITitle"]//h1[@class="ITitle"]/text()').extract()
		item['link'] = response.url
		item['markprice'] = site.select('//label[@id="ctl00_cph_lblPrice"]//span[@class="S"]/text()').extract()
		item['price'] = site.select('//label[@id="ctl00_cph_lblPrice"]//span[@class="ISelPr"]/text()').extract()
		item['description'] = site.select('//div[@class="I_IDesc"]/p/text()').extract()
		item['buylink'] = ""#site.select('//div[@id="mprod-buy-btn"]/a/@href').extract()
		tokens = response.url.split("/")
		imgbase = 'http://images.seventymm.com/Img/Item/ItemPoster/'
		if len(tokens) > 3:
			item['image'] = imgbase+tokens[len(tokens)-3]+'.jpg'
		relativePaths = site.select('//div[@id="ctl00_cph_divAlsoLike"]//div[@ctrltype="RCI"]/a/@href').extract()
		item['recid'] = map((lambda x: 'http://shop.seventymm.com' +x), relativePaths)
		items.append(item)
		return items
		