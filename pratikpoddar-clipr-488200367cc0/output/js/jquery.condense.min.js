(function(e){function t(t,r){if(e.trim(t.text()).length<=r.condensedLength+r.minTrail){o("element too short: skipping.");return false}var i=e.trim(t.html());var s=e.trim(t.text());var u=r.delim;var a=t.clone();var f=0;var of=-1;do{var l;if(f<=of){of=of+1;l=n(i,r.delim,r.condensedLength+of+1);}else {of=f;l=n(i,r.delim,r.condensedLength+f);} a.html(e.trim(i.substring(0,l+1)));var c=a.text().length;var h=a.html().length;f=a.html().length-c;o("condensing... [html-length:"+h+" text-length:"+c+" delta: "+f+" break-point: "+l+"]")}while(f&&a.text().length<r.condensedLength);if(s.length-c<r.minTrail){o("not enough trailing text: skipping.");return false}o("clone condensed. [text-length:"+c+"]");return a}function n(e,t,n){var i=false;var s=n;do{var s=e.indexOf(t,s);if(s<0){o("No delimiter found.");return e.length}i=true;while(r(e,s)){s++;i=false}}while(!i);o("Delimiter found in html at: "+s);return s}function r(e,t){return e.indexOf(">",t)<e.indexOf("<",t)}function i(e,t){o("Condense Trigger: "+e.html());var n=e.parent();var r=n.next();r.show();var i=r.width();var s=r.height();r.hide();var u=n.width();var a=n.height();n.animate({height:s,width:i,opacity:1},t.lessSpeed,t.easing,function(){n.height(a).width(u).hide();r.show()})}function s(e,t){o("Expand Trigger: "+e.html());var n=e.parent();var r=n.prev();if(t.expandedWidth){r.width(t.expandedWidth)}r.show();var i=r.width();var s=r.height();r.width(n.width()+"px").height(n.height()+"px");n.hide();r.animate({height:s,width:i,opacity:1},t.moreSpeed,t.easing);if(n.attr("id")){var u=n.attr("id");n.attr("id","condensed_"+u);r.attr("id",u)}}function o(e){if(window.console&&window.console.log&&false){window.console.log(e)}}e.fn.condense=function(n){e.metadata?o("metadata plugin detected"):o("metadata plugin not present");var r=e.extend({},e.fn.condense.defaults,n);return this.each(function(){$this=e(this);var n=e.metadata?e.extend({},r,$this.metadata()):r;o("Condensing ["+$this.text().length+"]: "+$this.text());var u=t($this,n);if(u){$this.attr("id")?$this.attr("id","condensed_"+$this.attr("id")):false;var a=" <span class='condense_control condense_control_more' style='cursor:pointer;'>"+n.moreText+"</span>";var f=" <span class='condense_control condense_control_less' style='cursor:pointer;'>"+n.lessText+"</span>";u.append(n.ellipsis+a);$this.after(u).hide().append(f);e(".condense_control_more",u).click(function(){o("moreControl clicked.");s(e(this),n)});e(".condense_control_less",$this).click(function(){o("lessControl clicked.");i(e(this),n)})}})};e.fn.condense.defaults={condensedLength:200,minTrail:20,delim:" ",moreText:"[more]",lessText:"[less]",ellipsis:" ( ... )",moreSpeed:"normal",lessSpeed:"normal",easing:"linear"}})(jQuery)